<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><META NAME="save" CONTENT="history" /><title>Usando a autenticação integrada Kerberos para conectar-se ao SQL Server</title><meta name="Language" content="pt-br" /><meta name="Microsoft.Help.Id" content="687802dc-042a-4363-89aa-741685d165b3" /><meta name="Description" content="A partir do Microsoft JDBC Driver 4.0 para SQL Server, um aplicativo pode usar a propriedade de conexão authenticationScheme para indicar que deseja se conectar a um banco de dados usando a autenticação integrada Kerberos tipo 4." /><meta name="Microsoft.Help.ContentType" content="Concepts" /><link rel="stylesheet" type="text/css" href="../local/Classic.css" /><script type="text/javascript" src="../scripts/EventUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/SplitScreen.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/Dropdown.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_manifold.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_feedBack.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CheckboxMenu.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CommonUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../local/script_main.js">&amp;nbsp;</script></head><body><div id="header"><table id="bottomTable" cellpadding="0" cellspacing="0"><tr><td align="left"><span id="headerBold">Usando a autenticação integrada Kerberos para conectar-se ao SQL Server</span></td></tr></table><table id="gradientTable"><tr><td class="nsrBottom" background="../icons/gradient.gif" /></tr></table></div><div id="mainSection"><div id="mainBody"><div class="introduction"><p>A partir do Microsoft JDBC Driver 4.0 para SQL Server, um aplicativo pode usar a propriedade de conexão <span sdata="langKeyword" value="authenticationScheme"><span class="keyword">authenticationScheme</span></span> para indicar que deseja se conectar a um banco de dados usando a autenticação integrada Kerberos tipo 4. Consulte <span sdata="link"><a href="f1b62700-f046-488d-bd6b-a5cd8fc345b7.htm">Definindo as propriedades de conexão</a></span> para obter mais informações sobre as propriedades de conexão. Para obter mais informações sobre Kerberos, consulte o artigo sobre <a href="http://go.microsoft.com/fwlink/?LinkId=101449">Suplemento técnico do Kerberos para Windows</a> e <a href="http://go.microsoft.com/fwlink/?LinkID=100758">Microsoft Kerberos</a>.</p><p>Ao usar a autenticação integrada com o Java <span sdata="langKeyword" value="Krb5LoginModule"><span class="keyword">Krb5LoginModule</span></span>, você pode configurar o módulo usando a <a href="http://download.oracle.com/javase/1.5.0/docs/guide/security/jaas/spec/com/sun/security/auth/module/Krb5LoginModule.html">Classe Krb5LoginModule</a>.</p><p>O Microsoft JDBC Driver para SQL Server define as seguintes propriedades para IBM Java VMs:</p><ul><li><p><span sdata="langKeyword" value="useDefaultCcache = true"><span class="keyword">useDefaultCcache = true</span></span></p></li><li><p><span sdata="langKeyword" value="moduleBanner = false"><span class="keyword">moduleBanner = false</span></span></p></li></ul><p>O Microsoft JDBC Driver para SQL Server define as seguintes propriedades para todas as outras Java VMs:</p><ul><li><p><span sdata="langKeyword" value="useTicketCache = true"><span class="keyword">useTicketCache = true</span></span></p></li><li><p><span sdata="langKeyword" value="doNotPrompt = true"><span class="keyword">doNotPrompt = true</span></span></p></li></ul></div><h1 class="heading">Comentários</h1><div id="sectionSection0" class="section" name="collapseableSection" style=""><p>Antes do Microsoft JDBC Driver 4.0 para SQL Server, os aplicativos podiam especificar a autenticação integrada (usando Kerberos ou NTLM, dependendo de qual estivesse disponível) usando a propriedade de conexão <span sdata="langKeyword" value="integratedSecurity"><span class="keyword">integratedSecurity</span></span> e referenciando <span sdata="langKeyword" value="sqljdbc_auth.dll"><span class="keyword">sqljdbc_auth.dll</span></span>, conforme descrito em <span sdata="link"><a href="44996746-d373-4f59-9863-a8a20bb8024a.htm">Construindo a URL de conexão</a></span>.</p><p>A partir do Microsoft JDBC Driver 4.0 para SQL Server, um aplicativo pode usar a propriedade de conexão <span sdata="langKeyword" value="authenticationScheme"><span class="keyword">authenticationScheme</span></span> para indicar que deseja se conectar a um banco de dados usando a autenticação integrada Kerberos por meio da implementação Java Kerberos pura.</p><ul><li><p>Se você desejar a autenticação integrada usando o <span sdata="langKeyword" value="Krb5LoginModule"><span class="keyword">Krb5LoginModule</span></span>, ainda precisará especificar a propriedade de conexão <span sdata="langKeyword" value="integratedSecurity=true"><span class="keyword">integratedSecurity=true</span></span>. Em seguida, especifique também a propriedade de conexão <span sdata="langKeyword" value="authenticationScheme=JavaKerberos"><span class="keyword">authenticationScheme=JavaKerberos</span></span>.</p></li><li><p>Para continuar usando a autenticação integrada com <span sdata="langKeyword" value="sqljdbc_auth.dll"><span class="keyword">sqljdbc_auth.dll</span></span>, basta especificar a propriedade de conexão <span sdata="langKeyword" value="integratedSecurity=true"><span class="keyword">integratedSecurity=true</span></span> (e, se desejar, <span sdata="langKeyword" value="authenticationScheme=NativeAuthentication"><span class="keyword">authenticationScheme=NativeAuthentication</span></span>).</p></li><li><p>Se você especificar <span sdata="langKeyword" value="authenticationScheme=JavaKerberos"><span class="keyword">authenticationScheme=JavaKerberos</span></span>, mas não especificar também <span sdata="langKeyword" value="integratedSecurity=true"><span class="keyword">integratedSecurity=true</span></span>, o driver ignorará a propriedade de conexão <span sdata="langKeyword" value="authenticationScheme"><span class="keyword">authenticationScheme</span></span> e esperará a localização das credenciais de nome de usuário e senha na cadeia de conexão.</p></li></ul><p>Ao usar uma fonte de dados para criar conexões, você pode definir o esquema de autenticação de modo programático usando <a href="b942f78e-7ce1-44ef-923d-a7c3d7c76b83.htm">setAuthenticationScheme</a>.</p><p>Um novo agente foi adicionado para oferecer suporte à autenticação Kerberos: com.microsoft.sqlserver.jdbc.internals.KerbAuthentication. Para obter mais informações, consulte <span sdata="link"><a href="723aeae7-6504-4585-ba8b-3525115bea8b.htm">Operação de rastreamento de driver</a></span>.</p><p>As seguintes diretrizes ajudarão você a configurar o Kerberos:</p><ol><li><p>Defina <span sdata="langKeyword" value="AllowTgtSessionKey"><span class="keyword">AllowTgtSessionKey</span></span> como 1 o Registro para Windows. Para obter mais informações, consulte o artigo sobre <a href="http://support.microsoft.com/kb/837361">Entradas de Registro do protocolo Kerberos e chaves de configuração do KDC no Windows Server 2003</a>.</p></li><li><p>Verifique se a configuração Kerberos (krb5.conf nos ambientes UNIX) indica o realm e KDC corretos para o seu ambiente.</p></li><li><p>Inicialize o cache TGT usando kinit ou logging no domínio.</p></li><li><p>Quando um aplicativo que usa <span sdata="langKeyword" value="authenticationScheme=JavaKerberos"><span class="keyword">authenticationScheme=JavaKerberos</span></span> é executado nos sistemas operacionais Windows Vista ou Windows 7, você deve usar uma conta de usuário padrão. No entanto, se você executar o aplicativo na conta de um administrador, o aplicativo deverá ser executado com privilégios de administrador.</p></li></ol></div><h1 class="heading">Nomes de Entidade de Serviço</h1><div id="sectionSection1" class="section" name="collapseableSection" style=""><p>Um SPN (nome da entidade de serviço) é o nome através do qual um cliente identifica exclusivamente uma instância de um serviço. Para obter mais informações sobre SPNs (nomes de entidade de serviço), consulte:</p><ul><li><p><a href="http://support.microsoft.com/kb/319723">Como usar a autenticação Kerberos no SQL Server</a></p></li><li><p><a href="http://go.microsoft.com/fwlink/?LinkId=207814">Usando Kerberos com SQL Server</a></p></li></ul></div><h1 class="heading">Criando um arquivo de configuração de módulo de logon</h1><div id="sectionSection2" class="section" name="collapseableSection" style=""><p>Se desejar, você pode especificar um arquivo de configuração Kerberos. Se um arquivo de configuração não for especificado, as configurações a seguir estarão em vigor:</p><dl class="authored"><dt>Sun JVM</dt><dd><p>com.sun.security.auth.module.Krb5LoginModule required useTicketCache=true doNotPrompt=true;</p></dd><dt>IBM JVM</dt><dd><p>com.ibm.security.auth.module.Krb5LoginModule required useDefaultCcache = true moduleBanner = false;</p></dd></dl><p>Se você decidir criar um arquivo de configuração de módulo de logon, o arquivo deverá ter o seguinte formato:</p><div class="sampleCode"><span codeLanguage="other"><pre>&lt;<i>name</i>&gt; {
    &lt;<i>LoginModule</i>&gt; &lt;<i>flag</i>&gt; &lt;<i>LoginModule options</i>&gt;;
    &lt;<i>optional_additional_LoginModules</i>, <i>flags_and_options</i>&gt;;
};</pre></span></div><p>Um arquivo de configuração de logon consiste em uma ou mais entradas, cada uma especificando qual tecnologia de autenticação subjacente deve ser usada para um ou mais aplicativos específicos. Por exemplo,</p><div class="sampleCode"><span codeLanguage="other"><pre>SQLJDBCDriver {
   com.sun.security.auth.module.Krb5LoginModule required useTicketCache=true doNotPrompt=true;
};</pre></span></div><p>Portanto, cada entrada do arquivo de configuração de módulo de logon consiste em um nome seguido por uma ou mais entradas específicas de LoginModule, onde cada uma delas é encerrada com um ponto-e-vírgula e todo o grupo de entradas específicas de LoginModule é delimitado por chaves. Cada entrada do arquivo de configuração é encerrado com um ponto-e-vírgula.</p><p>Além de permitir que o driver obtenha credenciais Kerberos usando as configurações especificadas no arquivo de configuração de módulo de logon, o driver pode usar credenciais existentes. Isso poderá ser útil quando o aplicativo precisar criar conexões usando as credenciais de mais de um usuário.</p><p>O driver tentará usar as credenciais existentes se elas estiverem disponíveis, antes de tentar fazer logon usando o módulo de logon especificado. Desse modo, ao usar o método Subject.doAs para executar o código em um contexto específico, uma conexão será criada com as credenciais passadas para a chamada de Subject.doAs.</p><p>Para obter mais informações, consulte os artigos sobre <a href="http://download.oracle.com/javase/1.4.2/docs/guide/security/jaas/tutorials/LoginConfigFile.html">Arquivo de configuração de logon JAAS</a> e <a href="http://download.oracle.com/javase/1.5.0/docs/guide/security/jgss/tutorials/KerberosReq.html">Classe Krb5LoginModule</a>.</p></div><h1 class="heading">Criando um arquivo de configuração Kerberos</h1><div id="sectionSection3" class="section" name="collapseableSection" style=""><p>Para obter mais informações sobre os arquivos de configuração Kerberos, consulte o artigo sobre <a href="http://download.oracle.com/javase/1.4.2/docs/guide/security/jaas/tutorials/LoginConfigFile.html">Requisitos do Kerberos</a>.</p><p>Este é um arquivo de configuração de domínio de exemplo, em que YYYY e ZZZZ são nomes de domínio no seu site.</p><div class="sampleCode"><span codeLanguage="other"><pre>[libdefaults]
default_realm = YYYY.CORP.CONTOSO.COM
dns_lookup_realm = false
dns_lookup_kdc = true
ticket_lifetime = 24h
forwardable = yes

[domain_realm]
.yyyy.corp.contoso.com = YYYY.CORP.CONTOSO.COM
.zzzz.corp.contoso.com = ZZZZ.CORP.CONTOSO.COM

[realms]
        YYYY.CORP.CONTOSO.COM = {
  kdc = krbtgt/YYYY.CORP. CONTOSO.COM @ YYYY.CORP. CONTOSO.COM
  default_domain = YYYY.CORP. CONTOSO.COM
}

        ZZZZ.CORP. CONTOSO.COM = {
  kdc = krbtgt/ZZZZ.CORP. CONTOSO.COM @ ZZZZ.CORP. CONTOSO.COM
  default_domain = ZZZZ.CORP. CONTOSO.COM
}
</pre></span></div></div><h1 class="heading">Habilitando o arquivo de configuração de domínio e o arquivo de configuração de módulo de logon</h1><div id="sectionSection4" class="section" name="collapseableSection" style=""><p>Você pode habilitar um arquivo de configuração de domínio com -Djava.security.krb5.conf. É possível habilitar um arquivo de configuração de módulo de logon com <span sdata="langKeyword" value="-Djava.security.auth.login.config"><span class="keyword">-Djava.security.auth.login.config</span></span>.</p><p>Por exemplo, quando você iniciar o aplicativo, poderá usar a seguinte linha de comando:</p><div class="sampleCode"><span codeLanguage="other"><pre>Java.exe -Djava.security.auth.login.config=SQLJDBCDriver.conf -Djava.security.krb5.conf=krb5.ini &lt;<i>APPLICATION_NAME</i>&gt;
</pre></span></div></div><h1 class="heading">Verificando se o SQL Server pode ser acessado via Kerberos</h1><div id="sectionSection5" class="section" name="collapseableSection" style=""><p>Execute a seguinte consulta no SQL Server Management Studio:</p><p><span sdata="langKeyword" value="select auth_scheme from sys.dm_exec_connections where session_id=@@spid"><span class="keyword">select auth_scheme from sys.dm_exec_connections where session_id=@@spid</span></span></p><p>Verifique se você tem a permissão necessária para executar essa consulta.</p></div><span id="seeAlsoSpan"><h1 class="heading">Consulte também</h1></span><div id="seeAlsoSection" class="section" name="collapseableSection" style=""><div class="seeAlsoStyle"><span sdata="link"><a href="94bcfbe3-f00e-4774-bda8-bb7577518fec.htm">Conectando ao SQL Server com o JDBC Driver</a></span></div></div></div><div id="footer" class="section"><span id="feedbackarea">Envie <a href="javascript:SubmitFeedback('DevDocs@Microsoft.com','','','','8.0.12060.10000','%0\dObrigado%20por%20seus%20comentários.%20As%20equipes%20de%20desenvolvimento%20usam%20seus%20comentários%20para%20melhorar%20a%20documentação.%20Enquanto%20estivermos%20examinando%20seus%20comentários%20,%20poderemos%20enviar%20um%20email%20solicitando%20mais%20esclarecimentos%20ou%20comentários%20sobre%20a%20solução%20encontrada%20.%20Não%20usaremos%20seu%20endereço%20de%20email%20para%20nenhum%20outro%20propósito%20e%20o%20excluiremos%20após%20concluirmos%20a%20análise.%0\APara%20obter%20informações%20sobre%20a%20política%20de%20privacidade%20da%20Microsoft,%20consulte%20http://privacy.microsoft.com/pt-br/default.aspx.%0\A%0\d','Comentários%20do%20cliente.');">comentários</a> sobre este tópico à Microsoft.</span><span id="copyrightarea"><p><a href="9bad553b-9e70-4696-8499-2e35f772a1e0.htm">© 2012 Microsoft. Todos os direitos reservados.</a></p></span></div></div></body></html>