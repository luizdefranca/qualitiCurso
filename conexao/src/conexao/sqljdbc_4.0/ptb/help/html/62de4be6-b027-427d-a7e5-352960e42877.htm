<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><META NAME="save" CONTENT="history" /><title>Suporte a driver JDBC para alta disponibilidade e recuperação de desastre</title><meta name="Language" content="pt-br" /><meta name="Microsoft.Help.Id" content="62de4be6-b027-427d-a7e5-352960e42877" /><meta name="Description" content="Este tópico aborda o suporte do Microsoft JDBC Driver para SQL Server para alta disponibilidade, recuperação de desastre -- Grupos de Disponibilidade AlwaysOn." /><meta name="Microsoft.Help.ContentType" content="Concepts" /><link rel="stylesheet" type="text/css" href="../local/Classic.css" /><script type="text/javascript" src="../scripts/EventUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/SplitScreen.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/Dropdown.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_manifold.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_feedBack.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CheckboxMenu.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CommonUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../local/script_main.js">&amp;nbsp;</script></head><body><div id="header"><table id="bottomTable" cellpadding="0" cellspacing="0"><tr><td align="left"><span id="headerBold">Suporte a driver JDBC para alta disponibilidade e recuperação de desastre</span></td></tr></table><table id="gradientTable"><tr><td class="nsrBottom" background="../icons/gradient.gif" /></tr></table></div><div id="mainSection"><div id="mainBody"><div class="introduction"><p>Este tópico aborda o suporte do Microsoft JDBC Driver para SQL Server para alta disponibilidade, recuperação de desastre -- Grupos de Disponibilidade AlwaysOn. Para obter mais informações sobre Grupos de Disponibilidade AlwaysOn, consulte os Manuais Online do SQL Server 2012.</p><p>Com a versão 4.0 do Microsoft JDBC Driver para SQL Server, você pode especificar o ouvinte do grupo de disponibilidade de um AG (grupo de disponibilidade) (alta disponibilidade, recuperação de desastre) na propriedade de conexão. Se um aplicativo Microsoft JDBC Driver para SQL Server estiver conectado a um banco de dados AlwaysOn que efetua failover, a conexão original será interrompida e o aplicativo deverá abrir uma nova conexão para continuar o trabalho após o failover.</p><p>Se você não estiver se conectando a um ouvinte de grupo de disponibilidade e se vários endereços IP estiverem associados a um servidor, o Microsoft JDBC Driver para SQL Server tentará se conectar ao primeiro endereço IP. Se o Microsoft JDBC Driver para SQL Server não puder estabelecer uma conexão com o primeiro endereço IP, a conexão apresentará falha. O Microsoft JDBC Driver para SQL Server não tentará se conectar a nenhum endereço IP subsequente associado ao servidor. Ao conectar-se a um ouvinte de grupo de disponibilidade, o Microsoft JDBC Driver para SQL Server tenta estabelecer conexões com todos os endereços IP paralelamente e, se uma conexão tentar continuar, o driver descartará qualquer tentativa de conexão pendente.</p><div style="margin: .5em 1.5em .5em 1.5em"><b></b><p>O aumento do tempo limite da conexão e a implementação da lógica de repetição de conexão aumentarão a probabilidade de um aplicativo se conectar a um grupo de disponibilidade. Além disso, como uma conexão pode apresentar falha devido a um failover de grupo de disponibilidade, você deve implementar a lógica de repetição de conexão, repetindo uma conexão com falha até que a reconexão seja estabelecida.</p></div><p>As seguintes <a href="f1b62700-f046-488d-bd6b-a5cd8fc345b7.htm">propriedades de conexão</a> foram adicionadas ao Microsoft JDBC Driver 4.0 para SQL Server:</p><ul><li><p><span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span></p></li><li><p><span sdata="langKeyword" value="applicationIntent"><span class="keyword">applicationIntent</span></span></p></li></ul></div><h1 class="heading">Conectando-se ao MultiSubnetFailover</h1><div id="sectionSection0" class="section" name="collapseableSection" style=""><p>Sempre especifique <span sdata="langKeyword" value="multiSubnetFailover=true"><span class="keyword">multiSubnetFailover=true</span></span> ao conectar-se ao ouvinte de grupo de disponibilidade de um grupo de disponibilidade do SQL Server 2012 ou de uma Instância de Cluster de Failover do SQL Server 2012. <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> permite um failover mais rápido para todos os Grupos de Disponibilidade e instâncias de cluster de failover no SQL Server 2012 e reduzirá significativamente o tempo do failover em topologias AlwaysOn de uma ou várias sub-redes. Durante um failover de várias sub-redes, o cliente tentará estabelecer conexões paralelamente. Durante um failover de sub-rede, o Microsoft JDBC Driver para SQL Server repetirá agressivamente a conexão TCP.</p><p>A propriedade de conexão <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> indica que o aplicativo está sendo implantado em um grupo de disponibilidade ou em uma Instância de Cluster de Failover, e que o Microsoft JDBC Driver para SQL Server tentará se conectar ao banco de dados na instância SQL Server primária tentando se conectar a todos os endereços IP. Quando <span sdata="langKeyword" value="MultiSubnetFailover=true"><span class="keyword">MultiSubnetFailover=true</span></span> é especificado para uma conexão, o cliente repete as tentativas de conexão TCP mais rápido do que os intervalos de retransmissão TCP padrão do sistema operacional. Isso permite uma reconexão mais rápida após o failover de um Grupo de Disponibilidade AlwaysOn ou de uma Instância de Cluster de Failover AlwaysOn, sendo aplicável a Grupos de Disponibilidade e Instâncias de Cluster de Failover de uma ou várias sub-redes.</p><p>Para obter mais informações sobre palavras-chave de cadeia de conexão no Microsoft JDBC Driver para SQL Server, consulte <span sdata="link"><a href="f1b62700-f046-488d-bd6b-a5cd8fc345b7.htm">Definindo as propriedades de conexão</a></span>.</p><p>A especificação de <span sdata="langKeyword" value="multiSubnetFailover=true"><span class="keyword">multiSubnetFailover=true</span></span> durante a conexão a algo que não seja um ouvinte de grupo de disponibilidade ou uma Instância de Cluster de Failover pode resultar em um impacto de desempenho negativo; não há suporte para essa especificação.</p><p>Se o gerenciador de segurança não for instalado, a Máquina Virtual Java armazenará VIPs (endereços IP virtuais) em cache por um período determinado, por padrão, definido pela implementação JDK e as propriedades Java networkaddress.cache.ttl e networkaddress.cache.negative.ttl. Se o gerenciador de segurança JDK for instalado, a Máquina Virtual Java armazenará VIPs em cache e não atualizará o cache, por padrão. Você deve definir a "vida útil" (networkaddress.cache.ttl) para um dia no cache da Máquina Virtual Java. Se você não alterar o valor padrão para um dia (ou valor parecido), o valor antigo não será limpo no cache da Máquina Virtual Java quando um VIP for adicionado ou atualizado. Para obter mais informações sobre networkaddress.cache.ttl e networkaddress.cache.negative.ttl, consulte <a href="http://download.oracle.com/javase/6/docs/technotes/guides/net/properties.html">http://download.oracle.com/javase/6/docs/technotes/guides/net/properties.html</a>.</p><p>Use as seguintes diretrizes para se conectar a um servidor em um grupo de disponibilidade ou em uma Instância de Cluster de Failover:</p><ul><li><p>O driver gerará um erro se a propriedade de conexão <span sdata="langKeyword" value="instanceName"><span class="keyword">instanceName</span></span> for usada na mesma cadeia de conexão da propriedade de conexão <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span>. Isso acontece porque o Navegador SQL não é usado em um grupo de disponibilidade. No entanto, se a propriedade de conexão <span sdata="langKeyword" value="portNumber"><span class="keyword">portNumber</span></span> também for especificada, o driver ignorará <span sdata="langKeyword" value="instanceName"><span class="keyword">instanceName</span></span> e usará <span sdata="langKeyword" value="portNumber"><span class="keyword">portNumber</span></span>.</p></li><li><p>Use a propriedade de conexão <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> quando estiver se conectando a uma ou várias sub-redes; isso melhorará o desempenho em ambos os casos.</p></li><li><p>Para se conectar a um grupo de disponibilidade, especifique o ouvinte do grupo de disponibilidade como servidor na cadeia de conexão. Por exemplo, jdbc:sqlserver://VNN1.</p></li><li><p>A conexão a uma instância do SQL Server configurada com mais de 64 endereços IP ocasionará uma falha na conexão.</p></li><li><p>O comportamento de um aplicativo que usa a propriedade de conexão <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> não é afetado com base no tipo de autenticação: Autenticação SQL Server, Autenticação Kerberos ou Autenticação do Windows.</p></li><li><p>Aumente o valor de <span sdata="langKeyword" value="loginTimeout"><span class="keyword">loginTimeout</span></span> para acomodar o tempo de failover e reduza as tentativas de repetição da conexão do aplicativo.</p></li><li><p>Não há suporte para transações distribuídas.</p></li></ul><p>Se o roteamento somente leitura não estiver em vigor, a conexão a um local de réplica secundária em um grupo de disponibilidade apresentará falha nas seguintes situações:</p><ol><li><p>Se o local da réplica secundária não estiver configurado para aceitar conexões.</p></li><li><p>Se um aplicativo usar <span sdata="langKeyword" value="applicationIntent=ReadWrite"><span class="keyword">applicationIntent=ReadWrite</span></span> (abordado abaixo) e o local da réplica secundária estiver configurado para acesso somente leitura.</p></li></ol><p>Uma conexão apresentará falha se uma réplica primária estiver configurada para rejeitar cargas de trabalho somente leitura e a cadeia de conexão contiver <span sdata="langKeyword" value="ApplicationIntent=ReadOnly"><span class="keyword">ApplicationIntent=ReadOnly</span></span>.</p></div><h1 class="heading">Atualizando para Usar Clusters de Várias Sub-redes no Espelhamento de Banco de Dados</h1><div id="sectionSection1" class="section" name="collapseableSection" style=""><p>Se você atualizar um aplicativo Microsoft JDBC Driver para SQL Server que usa espelhamento de banco de dados em um cenário de várias sub-redes, deverá remover a propriedade de conexão <span sdata="langKeyword" value="failoverPartner"><span class="keyword">failoverPartner</span></span>, substituí-la por <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> definido como <span sdata="langKeyword" value="true"><span class="keyword">true</span></span> e substituir o nome do servidor na cadeia de conexão por um ouvinte de grupo de disponibilidade. Se a cadeia de conexão usar <span sdata="langKeyword" value="failoverPartner"><span class="keyword">failoverPartner</span></span> e <span sdata="langKeyword" value="multiSubnetFailover=true"><span class="keyword">multiSubnetFailover=true</span></span>, o driver gerará um erro. No entanto, se uma cadeia de conexão usar <span sdata="langKeyword" value="failoverPartner"><span class="keyword">failoverPartner</span></span> e <span sdata="langKeyword" value="multiSubnetFailover=false"><span class="keyword">multiSubnetFailover=false</span></span> (ou <span sdata="langKeyword" value="ApplicationIntent=ReadWrite"><span class="keyword">ApplicationIntent=ReadWrite</span></span>), o aplicativo usará o espelhamento de banco de dados.</p><p>O driver retornará um erro se o espelhamento de banco de dados for usado no banco de dados primário no AG e se <span sdata="langKeyword" value="multiSubnetFailover=true"><span class="keyword">multiSubnetFailover=true</span></span> for usado na cadeia de conexão que se conecta a um banco de dados primário, e não a um ouvinte de grupo de disponibilidade.</p></div><h1 class="heading">Especificando Tentativa de Aplicativo</h1><div id="sectionSection2" class="section" name="collapseableSection" style=""><p>Quando <span sdata="langKeyword" value="applicationIntent=ReadOnly"><span class="keyword">applicationIntent=ReadOnly</span></span>, o cliente solicita uma carga de trabalho somente leitura ao se conectar a um banco de dados habilitado AlwaysOn. O serviço imporá a tentativa no momento da conexão e durante uma instrução de banco de dados USE, mas somente a um banco de dados habilitado AlwaysOn.</p><p>A palavra-chave <span sdata="langKeyword" value="applicationIntent"><span class="keyword">applicationIntent</span></span> não funciona com bancos de dados herdados somente leitura.</p><p>Um banco de dados pode permitir ou proibir cargas de trabalho de leitura no banco de dados AlwaysOn de destino. (Isso é feito com a cláusula <span sdata="langKeyword" value="ALLOW_CONNECTIONS"><span class="keyword">ALLOW_CONNECTIONS</span></span> das instruções <span sdata="langKeyword" value="PRIMARY_ROLE"><span class="keyword">PRIMARY_ROLE</span></span> e <span sdata="langKeyword" value="SECONDARY_ROLE"><span class="keyword">SECONDARY_ROLE</span></span> Transact-SQL.)</p><p>A palavra-chave <span sdata="langKeyword" value="applicationIntent"><span class="keyword">applicationIntent</span></span> é usada para habilitar o roteamento somente leitura.</p></div><h1 class="heading">Roteamento somente leitura</h1><div id="sectionSection3" class="section" name="collapseableSection" style=""><p>O roteamento somente leitura é um recurso que pode garantir a disponibilidade de uma réplica somente leitura de um banco de dados. Para habilitar o roteamento somente leitura:</p><ol><li><p>Você deve se conectar a um ouvinte de grupo de disponibilidade do Grupo de Disponibilidade AlwaysOn.</p></li><li><p>A palavra-chave de cadeia de conexão <span sdata="langKeyword" value="applicationIntent"><span class="keyword">applicationIntent</span></span> deve ser definida como <span sdata="langKeyword" value="ReadOnly"><span class="keyword">ReadOnly</span></span>.</p></li><li><p> O Grupo de Disponibilidade deve ser configurado pelo administrador de banco de dados para habilitar o roteamento somente leitura.</p></li></ol><p>É possível que, das várias conexões que usam o roteamento somente leitura, nem todas se conectem à mesma réplica somente leitura. As alterações na sincronização do banco de dados ou as alterações na configuração de roteamento do servidor podem resultar em conexões de cliente com diferentes réplicas somente leitura. Para garantir que todas as solicitações somente leitura se conectem à mesma réplica somente leitura, não passe um ouvinte de grupo de disponibilidade ou endereço IP virtual para a palavra-chave de cadeia de conexão <span sdata="langKeyword" value="serverName"><span class="keyword">serverName</span></span>. Em vez disso, especifique o nome da instância somente leitura.</p><p>O roteamento somente leitura pode demorar mais do que a conexão com a réplica primária, pois o roteamento somente leitura se conecta primeiro à réplica primária para, depois, procurar a melhor réplica secundária legível disponível. Por isso, você deve aumentar o tempo limite de logon.</p></div><h1 class="heading">Novos métodos que oferecem suporte a multiSubnetFailover e applicationIntent</h1><div id="sectionSection4" class="section" name="collapseableSection" style=""><p>Os seguintes métodos oferecem acesso programático às palavras-chave de cadeia de conexão <span sdata="langKeyword" value="multiSubnetFailover"><span class="keyword">multiSubnetFailover</span></span> e <span sdata="langKeyword" value="applicationIntent"><span class="keyword">applicationIntent</span></span>:</p><ul><li><p><a href="19411e6c-c456-4533-8252-54569a2a6b1f.htm">SQLServerDataSource.getApplicationIntent</a></p></li><li><p><a href="e164c8ac-a0ae-4638-affb-ed454e7c0708.htm">SQLServerDataSource.setApplicationIntent</a></p></li><li><p><a href="1e8cb175-5f4c-4208-b4f5-3646990a30e3.htm">SQLServerDataSource.getMultiSubnetFailover</a></p></li><li><p><a href="7ffd282d-c2f6-4d1b-a7a6-859d18b388aa.htm">SQLServerDataSource.setMultiSubnetFailover</a></p></li><li><p><a href="b5eaad8a-31ef-44ac-af11-d5caa13ac3e2.htm">SQLServerDriver.getPropertyInfo</a></p></li></ul><p>Os métodos <span sdata="langKeyword" value="getMultiSubnetFailover"><span class="keyword">getMultiSubnetFailover</span></span>, <span sdata="langKeyword" value="setMultiSubnetFailover"><span class="keyword">setMultiSubnetFailover</span></span>, <span sdata="langKeyword" value="getApplicationIntent"><span class="keyword">getApplicationIntent</span></span> e <span sdata="langKeyword" value="setApplicationIntent"><span class="keyword">setApplicationIntent</span></span> também são adicionados a <span sdata="link"><a href="097434fd-2b74-411c-a5ed-eba04481dde5.htm">Classe SQLServerDataSource</a></span>, <span sdata="link"><a href="b00e5a90-2af7-4d04-8ef8-256183777dcf.htm">SQLServerConnectionPoolDataSource Class</a></span> e <span sdata="link"><a href="95fc7b07-2498-4a7e-8f7f-ee0d86b598b4.htm">Classe SQLServerXADataSource</a></span>.</p></div><h1 class="heading">Validação do certificado SSL</h1><div id="sectionSection5" class="section" name="collapseableSection" style=""><p>Um grupo de disponibilidade consiste em vários servidores físicos. O Microsoft JDBC Driver 4.0 para SQL Server adicionou o suporte para <span sdata="langKeyword" value="Subject Alternate Name"><span class="keyword">Subject Alternate Name</span></span> em certificados SSL, portanto, vários hosts podem ser associados ao mesmo certificado. Para obter mais informações sobre o SSL, consulte <span sdata="link"><a href="073f3b9e-8edd-4815-88ea-de0655d0325e.htm">Compreendendo o suporte a SSL</a></span>.</p></div><span id="seeAlsoSpan"><h1 class="heading">Consulte também</h1></span><div id="seeAlsoSection" class="section" name="collapseableSection" style=""><div class="seeAlsoStyle"><span sdata="link"><a href="f1b62700-f046-488d-bd6b-a5cd8fc345b7.htm">Definindo as propriedades de conexão</a></span></div><div class="seeAlsoStyle"><span sdata="link"><a href="94bcfbe3-f00e-4774-bda8-bb7577518fec.htm">Conectando ao SQL Server com o JDBC Driver</a></span></div></div></div><div id="footer" class="section"><span id="feedbackarea">Envie <a href="javascript:SubmitFeedback('DevDocs@Microsoft.com','','','','8.0.12060.10000','%0\dObrigado%20por%20seus%20comentários.%20As%20equipes%20de%20desenvolvimento%20usam%20seus%20comentários%20para%20melhorar%20a%20documentação.%20Enquanto%20estivermos%20examinando%20seus%20comentários%20,%20poderemos%20enviar%20um%20email%20solicitando%20mais%20esclarecimentos%20ou%20comentários%20sobre%20a%20solução%20encontrada%20.%20Não%20usaremos%20seu%20endereço%20de%20email%20para%20nenhum%20outro%20propósito%20e%20o%20excluiremos%20após%20concluirmos%20a%20análise.%0\APara%20obter%20informações%20sobre%20a%20política%20de%20privacidade%20da%20Microsoft,%20consulte%20http://privacy.microsoft.com/pt-br/default.aspx.%0\A%0\d','Comentários%20do%20cliente.');">comentários</a> sobre este tópico à Microsoft.</span><span id="copyrightarea"><p><a href="9bad553b-9e70-4696-8499-2e35f772a1e0.htm">© 2012 Microsoft. Todos os direitos reservados.</a></p></span></div></div></body></html>